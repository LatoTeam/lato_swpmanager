<%

block = view(:layout, :block).new

project_button = view(:component, :button).new(title: 'Go to project',
url: lato_swpmanager.project_path(@project.id), size: :small)

tasks_button = view(:component, :button).new(title: 'Tasks',
url: lato_swpmanager.project_tasks_path(id: @project.id), size: :small, color: :yellow)

tasks_actionbar = view(:layout, :actionbar).new(title: "Project timeline", widgets: [
    {component: project_button, align: :right},
    {component: tasks_button, align: :right}
  ])

%>

<%=raw tasks_actionbar %>

<div class="content-row">
  <%=raw block.open(width: 'large') %>

      <h6 class="latoswpmanager-small-title">Tasks timeline from <%= @init_date.strftime('%d/%m') %> to <%= @end_date.strftime('%d/%m') %></h6>

      <div class="latoswpmanager-timeline">

        <a href="<%= lato_swpmanager.project_timeline_path(@project.id, @init_date - 1) %>" class="timeline-navigation-arrow prev"><</a>
        <a href="<%= lato_swpmanager.project_timeline_path(@project.id, @init_date + 1) %>" class="timeline-navigation-arrow next">></a>
        
        <% (@init_date..@end_date).to_a.each do |date| %>
        <% tasks = @tasks.where('start_date <= ?', date).where('end_date >= ?', date) %>
          <div class="timeline-day">
            <div class="timeline-day-title <%= date == Date.today ? 'today' : nil %>"><%= date.strftime('%d/%m') %></div>
            <div class="timeline-tasks">
              <% tasks.each do |task| %>
                <a href="<%= lato_swpmanager.task_path(task.id) %>" class="timeline-task <%= task.status %>">
                  <span class="timeline-task-time"><%= task.real_work_time ? task.real_work_time : task.expected_work_time %></span>
                  <div class="timeline-task-title"><%= task.title %></div>
                  <div class="timeline-task-info"><%= task.collaborator.string_complete_name %></div>
                </a>
              <% end %>
            </div>
          </div>
        <% end %>

      </div>

  <%=raw block.close %>
</div>
